{% extends 'base.html' %}

{% block content %}
  <h3>COVID Vaccination Data Exploration</h3>
  <p class="font-italic">This is work in progress!</p>
  <section>
    <h1 id="predictions">Predictions</h1>
    <p>
      Showing data for <b>{{ state }}</b> and assuming that the future 
      vaccination rate will be <b>{{ multiplier }}x</b> the past vaccination rate.</p>

    <!-- Dropdowns-->
    <div class="row">
      <div class="col-auto">
        <div class="dropdown">
          <button class="btn btn-info dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Select State
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            {% for state_name in all_states.keys() %}
            <a class="dropdown-item" href="?state={{ all_states[state_name]}}&multiplier={{multiplier}}">{{ state_name }}</a>
            {% endfor %}
          </div>
        </div>

      </div>
      <div class="col-auto">
        <div class="dropdown">
          <button class="btn btn-info dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Select Future Vaccination Rate
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            <a class="dropdown-item" href="?state={{state}}&multiplier=0.5">0.5x Past Rate</a>
            <a class="dropdown-item" href="?state={{state}}&multiplier=0.75">0.75x Past Rate</a>
            <a class="dropdown-item" href="?state={{state}}&multiplier=1">1x Past Rate</a>
            <a class="dropdown-item" href="?state={{state}}&multiplier=1.25">1.25x Past Rate</a>
            <a class="dropdown-item" href="?state={{state}}&multiplier=1.5">1.5x Past Rate</a>
            <a class="dropdown-item" href="?state={{state}}&multiplier=2">2x Past Rate</a>
          </div>
        </div>
      </div>
    </div>

    <!-- TODO create prediction graph (like https://plotly.com/javascript/continuous-error-bars/) -->
    <div class="row">
      <div class="col">
        <div id="prediction_dataviz"></div>
      </div>
    </div>
    <div class="row">
      <div class="col">
        <div id="vaccine_dataviz"></div>
      </div>
    </div>
    <script>
      // convert the data from json to a JS object
      var dailyCases = {{ daily_cases|tojson }};
      var dailyVaccinations = {{ daily_vaccinations|tojson }};
      var futureVaccinations = {{ future_vaccinations|tojson }}
      var predictedCases = {{ predictions|tojson }}
      
      // create the visualizations
      render_prediction_visualization(dailyCases, predictedCases)
      render_vaccine_visualization(dailyVaccinations, futureVaccinations)
    </script>
  </section>
  <section>
    <h1 id="exploration">Data Exploration</h1>
    <!-- TODO: make exploration graphs-->
    <!-- Potential exploration graph type https://plotly.com/javascript/splom/ -->
    <!-- Basic scatterplot https://plotly.com/javascript/line-and-scatter/-->
    <div class="row">
      <div class="col">
        <div id="population_dataviz"></div>
      </div>
    </div>
    <div class="row">
      <div class="col">
        <div id="policy_dataviz"></div>
      </div>
    </div>
    <div class="row">
      <div class="col">
        <div id="influenza_dataviz"></div>
      </div>
    </div>
    <div class="row">
      <div class="col">
        <div id="total_vax_dataviz"></div>
      </div>
    </div>
    <div class="row">
      <div class="col">
        <div id="distrib_vax_dataviz"></div>
      </div>
    </div>
    <script>
      // convert the data from json to a JS object
      var populations = {{ state_pop|tojson }};
      var nationalCases = {{ national_cases_dict|tojson }};
      var influenzaCounts = {{ influenza_counts|tojson }};  
      var nationalTotalVaccinations = {{ national_total_vax_dict|tojson }};
      var nationalDistribVaccinations = {{ national_distrib_vax_dict|tojson }};
      
      // create the visualizations
      render_population_visualization(populations)
      render_influenza_visualization(influenzaCounts, nationalCases)
      render_total_vax_visualization(nationalTotalVaccinations)
      render_distrib_vax_visualization(nationalDistribVaccinations)
    </script>
  </section>
{% endblock %}